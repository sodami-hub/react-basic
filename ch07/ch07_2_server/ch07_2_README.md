# 07-2 í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ëª½ê³  DB ì‚¬ìš©í•˜ê¸°

## ğŸˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°
```shell
# package.json íŒŒì¼ì„ ìƒì„±í•œë‹¤.
> yarn init -y  
# íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°œë°œì–¸ì–´ë¡œ ì‚¬ìš©í•˜ëŠ” Node.js í”„ë¡œì íŠ¸ëŠ” í•­ìƒ ë‹¤ìŒ 3ê°œì˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤. typescript, ts-nodeëŠ” ì „ì—­ìœ¼ë¡œ ì„¤ì¹˜í–ˆì§€ë§Œ ê´€í–‰ìœ¼ë¡œ ì„¤ì¹˜í•´ì¤€ë‹¤.
# @types/node íŒ¨í‚¤ì§€ëŠ” setTimeoutê³¼ ê°™ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•  ë•Œ í•„ìš”í•œ íƒ€ì… ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
> yarn add -D typescript ts-node @types/node 
# ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ tsconfig.json ì„¤ì • íŒŒì¼ì„ ë§Œë“ ë‹¤.
> tsc --init
# íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ë¡œ ëª½ê³ DBë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒì˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.
> yarn add mongodb
> yarn add -D @types/mongodb
```

## ğŸˆ ëª½ê³ DBì™€ ì—°ê²°í•˜ê¸°
í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ë‹¤ìŒ URLì„ ì‚¬ìš©í•˜ë©´ ëª½ê³ DBì™€ ì—°ê²°í•  ìˆ˜ ìˆë‹¤. mongodbëŠ” í”„ë¡œí† ì½œì´ë¦„ì´ê³ , localhostëŠ” í˜¸ìŠ¤íŠ¸ì´ë¦„, ê¸°ë³¸  í¬íŠ¸ëŠ” 27017ì´ë‹¤.
```
mongodb://localhost:27017
```
mongodb íŒ¨í‚¤ì§€ëŠ” ëª½ê³ dbì™€ ì—°ê²°ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆë„ë¡ MongoClient í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

```typescript jsx
import {MongoClient} from "mongodb";
```
MongoClient í´ë˜ìŠ¤ëŠ” ë‹¤ìŒì²˜ëŸ¼ connect ì •ì  ë©”ì„œë“œë¥¼ ì œê³µí•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ í˜•íƒœë¡œ MongoClient ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì–»ëŠ”ë‹¤.
```
static connect(url:string): Promise(MongoClient)
```
ì´ì œ ëª½ê³ DB ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ src ë””ë ‰í„°ë¦¬ì— mongodbë€ ì´ë¦„ì˜ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  ì´ ë””ë ‰í„°ë¦¬ì— connectAndUseDB.ts, index.ts
íŒŒì¼ì„ ìƒì„±í•œë‹¤.  
ê·¸ë¦¬ê³  src/mongodb/connectAndUseDB.ts ì— ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. ì´ ì½”ë“œëŠ” ëª½ê³ ì…¸ì—ì„œ use ëª…ë ¹ìœ¼ë¡œ DBë¥¼ ì„ íƒí•œ ê²ƒê³¼ ê°™ë‹¤.  
src/test/connectTest.ts íŒŒì¼ì„ ë§Œë“¤ê³ , ì ‘ì†ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.  
í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤. ëª½ê³ DBê°€ ì‘ë‹µí•˜ì—¬ ì‹¤í–‰ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ë©´ ì ‘ì†ì— ì„±ê³µí•œ ê²ƒì´ë‹¤. ëª½ê³ DB í´ë¼ì´ì–¸íŠ¸ê°€ ê³„ì†
ë™ì‘ ì¤‘ì´ë¯€ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í–ˆìœ¼ë©´ ctrl+cë¥¼ ëˆŒëŸ¬ ì¢…ë£Œí•œë‹¤.
```shell
> ts-node src/test/connectTest.ts 
```

## ğŸˆ ì»¬ë ‰ì…˜ì˜ CRUD ë©”ì„œë“œ
í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ëª½ê³ DBì˜ CRUDë¥¼ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì•Œì•„ë³´ê² ë‹¤. ëª½ê³ ì…¸ì—ì„œëŠ” 'db.ì»¬ë ‰ì…˜_ì´ë¦„'í˜•íƒœë¡œ ì»¬ë ‰ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆëŠ”ë°,
í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ ì ‘ê·¼í•´ì•¼ ëœë‹¤.
```
db.collection(ì»¬ë ‰ì…˜_ì´ë¦„)
```

### ğŸ•¸ï¸ ë¬¸ì„œ ìƒì„± ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°
ì´ì œ userë¼ëŠ” ì´ë¦„ì˜ ì»¬ë ‰ì…˜ì— insertOne ê³¼ insertMany ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì…ë ¥í•´ë³´ê²Ÿë‹¤. ë‹¤ìŒì€ ë‘ ë©”ì„œë“œì˜ íƒ€ì… ì„ ì–¸ë¬¸ìœ¼ë¡œ
ë‘˜ ëª¨ë‘ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.
```
insertOne(doc: OptionalUnlessRequiredId<TSchema>, options?: InsertOneOptions): Promise<InsertOneResult<TSchema>>;
insertMany(docs: ReadonlyArray<OptionalUnlessRequiredId<TSchema>>, options?: BulkWriteOptions): Promise<InsertManyResult<TSchema>>;
```
ë¨¼ì € src/test/insertTest.ts íŒŒì¼ì„ ìƒì„±í•˜ê³  ë¬¸ì„œ ìƒì„± ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. ê·¸ë¦¬ê³  ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ
íŒŒì¼ì„ ì‹¤í–‰í•œë‹¤. jackê³¼ janeAndTomì€ ëª½ê³ ì…¸ì—ì„œ ì‹¤í–‰ ê²°ê³¼ì™€ ì¼ì¹˜í•œë‹¤. ì´ ì‹¤í–‰ ê²°ê³¼ëŠ” InsertOneResult ì™€
InsertManyResult íƒ€ì…ì´ ì–´ë–¤ ì†ì„±ë“¤ì„ ì œê³µí•˜ëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤.
```shell
\ch07\ch07_2_server> ts-node .\src\test\insertTest.ts
jack {
  acknowledged: true,
  insertedId: new ObjectId('67dbb0ae4a9e1ad95edac480')
}
janeAndTom {
  acknowledged: true,
  insertedCount: 2,
  insertedIds: {
    '0': new ObjectId('67dbb0ae4a9e1ad95edac481'),
    '1': new ObjectId('67dbb0ae4a9e1ad95edac482')
  }
```
ctrl+c ë¥¼ ëˆŒëŸ¬ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•œë‹¤.

### ğŸ•¸ï¸ ë¬¸ì„œ ê²€ìƒ‰ ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°
findOne ê³¼ find ë©”ì„œë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ íƒ€ì… ì„ ì–¸ë¬¸ìœ¼ë¡œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” findOne ê³¼ ë‹¬ë¦¬ 
findëŠ” FindCursor íƒ€ì… ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
```
findOne(filter: Filter<TSchema>): Promise<WithId<TSchema> | null>;
find(filter: Filter<TSchema>, options?: FindOptions & Abortable): FindCursor<WithId<TSchema>>;
```

FindCursor íƒ€ì… ê°ì²´ëŠ” ë‹¤ìŒ ì½”ë“œì—ì„œ ë³´ë“¯ toArray ë€ ë©”ì„œë“œë¥¼ ì œê³µí•˜ì—¬ find ì˜ ë°˜í™˜ê°’ì„ ë°°ì—´ë¡œ ë°”ê¿”ì¤€ë‹¤.
```typescript
const cursor = await find({})
const arrayResult = cursor.toArray()
```
src/test/findTest.ts íŒŒì¼ì„ ìƒì„±í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. ì½”ë“œëŠ” findOnd ê³¼ find ë©”ì„œë“œë¡œ 'user' ì»¬ë ‰ì…˜ì—
ì €ì¥ëœ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ëŠ”ë°, findëŠ” ì»¤ì„œ íƒ€ì… ê°ì²´ê°€ ë°˜í™˜ë˜ë¯€ë¡œ ì´ ê°ì²´ì˜ toArray ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë°°ì—´ë¡œ ë§Œë“ ë‹¤.  
ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì•ì„  insertTest.ts ì—ì„œ user ì»¬ë ‰ì…˜ì— ì‚½ì…í•œ ë¬¸ì„œë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ğŸ•¸ï¸ ë¬¸ì„œ ìˆ˜ì • ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°
ë¬¸ì„œ ìˆ˜ì • ê´€ë ¨ ë©”ì„œë“œë“¤**(updateOne, updateMany, findOneAndUpdate)**ì€ ëª¨ë‘ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
ê·¸ëŸ°ë° findOneAndUpdate ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ëª½ê³ ì…¸ì—ì„œëŠ” returnNewDocument ì†ì„±ê°’ì„ true(ë³€ê²½ëœ ê°’ ë°˜í™˜)ë¡œ í–ˆì§€ë§Œ,
í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ì´ì™€ ê°™ì€ íš¨ê³¼ë¥¼ ë³´ë ¤ë©´ ì†ì„±ê°’ì„ 'after'ë¡œ í•´ì•¼ ëœë‹¤.(before ì™€ after ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•œë‹¤.) 
src/test/updateTest.ts íŒŒì¼ì„ ìƒì„±í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

### ğŸ•¸ï¸ ë¬¸ì„œ ì‚­ì œ ë©”ì„œë“œ ì‚¬ìš©í•˜ê¸°
deleteOneê³¼ deleteMany ë©”ì„œë“œëŠ” ëª¨ë‘ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
src/test/deleteTest.ts íŒŒì¼ì„ ìƒì„±í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.




## ğŸˆ
### ğŸ•¸ï¸








































